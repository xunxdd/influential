//var allInfluencers = [{ "Id": 1, "Name": "Chiara Ferragni", "Description": "The Blonde Salad", "Blog": "http://www.theblondesalad.com/", "BlogUrl": "http://www.theblondesalad.com/", "TwitterHandle": "chiaraferragni", "InstagramHandle": "chiaraferragni", "category": "Fashion", "image": "Chiara Ferragni.jpg" }, { "Id": 2, "Name": "Aime Song", "Description": "Song of Style", "Blog": "http://www.songofstyle.com/", "TwitterHandle": "aimeesong", "InstagramHandle": "songofstyle", "category": "Fashion", "image": "Aime Song.jpg" }, { "Id": 3, "Name": "Wendy Nguyen", "Description": "Wendy's Lookbook", "Blog": "http://www.wendyslookbook.com/", "TwitterHandle": "wendynguyen", "InstagramHandle": "wendyslookbook", "category": "Fashion", "image": "Wendy Nguyen.jpg" }, { "Id": 4, "Name": "Kristina Bazan", "Description": "Kayture", "Blog": "http://www.kayture.com/", "TwitterHandle": "Kayture", "InstagramHandle": "kristina_bazan", "category": "Fashion", "image": "Kristina Bazan.jpg" }, { "Id": 5, "Name": "Julie Sarinana", "Description": "Sincerely Jules", "Blog": "http://sincerelyjules.com/", "TwitterHandle": "SincerelyJules", "InstagramHandle": "sincerelyjules", "category": "Fashion", "image": "Julie Sarinana.jpg" }, { "Id": 6, "Name": "Rumi Neely", "Description": "Fashion Toast", "Blog": "http://fashiontoast.com/", "TwitterHandle": "rumineely", "InstagramHandle": "rumineely", "category": "Fashion", "image": "Rumi Neely.jpg" }, { "Id": 7, "Name": "Nicole Warn", "Description": "Garry Pepper Girl", "Blog": "http://garypeppergirl.com/", "TwitterHandle": "garypeppergirl", "InstagramHandle": "garypeppergirl", "category": "Fashion", "image": "Nicole Warn.jpg" }, { "Id": 8, "Name": "Julia Hengel", "Description": "Gal Meets Glams", "Blog": "http://galmeetsglam.com/", "TwitterHandle": "GalMeetsGlam", "InstagramHandle": "juliahengel", "category": "Fashion", "image": "Julia Hengel.jpg" }, { "Id": 9, "Name": "Blaire Eady", "Description": "Atlantic-Pacific", "Blog": "http://atlantic-pacific.blogspot.com/", "TwitterHandle": "BlairEadieBEE", "InstagramHandle": "blaireadiebee", "category": "Fashion", "image": "Blaire Eady.jpg" }, { "Id": 10, "Name": "Betty Autier", "Description": "Le Blog de Betty", "Blog": "http://www.leblogdebetty.com/en/", "TwitterHandle": "bettyautier", "InstagramHandle": "bettyautier", "category": "Fashion", "image": "Betty Autier.jpg" }, { "Id": 11, "Name": "RASA MALAYSIA", "Description": "Rasa Malaysia features over 800 easy, Asian recipes for beginner to advanced cooks. Created by Malaysian born recipe developer and cookbook author, Bee Yinn Low, this is the perfect food blog for those looking to expand their culinary repertoire.|", "Blog": "RasaMalaysia.com", "TwitterHandle": "RasaMalaysia", "InstagramHandle": "rasamalaysia", "category": "Food", "image": "RASA MALAYSIA.jpg" }, { "Id": 12, "Name": "THE FIRST MESS", "Description": "Laura Wright", "Blog": "TheFirstMess.com", "TwitterHandle": "Laura_Mess", "InstagramHandle": "thefirstmess", "category": "Food", "image": "Betty Autier.jpg" }, { "Id": 13, "Name": "DELIGHTFUL CRUMB", "Description": "Stacy Ladenburger, a midwest girl in a Californian, world created Delightful Crumb to fulfill two of her greatest passions: food and writing. Containing recipes that feature whole foods and seasonal ingredients, this vegetarian food blog has recipes that can be enjoyed by all.", "Blog": "DelightfulCrumb.com", "TwitterHandle": "SladenBurger", "InstagramHandle": "sladenburger", "category": "Food", "image": "DELIGHTFUL CRUMB.jpg" }, { "Id": 14, "Name": "YUMMY SUPPER", "Description": "Food and lifestyle photographer Erin Scott serves up a visual treat at food blog Yummy Supper. Diagnosed with Celiac Disease several years ago her vast array of simple, seasonal, gluten-free meals will inspire even the most reluctant cook.", "Blog": "YummySupper.blogspot.com", "TwitterHandle": "YummySupperblog", "InstagramHandle": "yummysupper", "category": "Food", "image": "YUMMY SUPPER.jpg" }, { "Id": 15, "Name": "Alquimia Dos Tachos", "Description": "Alquimia Dos Tachos is a Portuguese food blog that delivers enticing recipes for the discerning diner. From Two Ingredient Flourless Nutella Cake to Cod Gratin, bring a slice of Oporto to your table without having to leave the comfort of your own home.", "Blog": "AlquimiaDosTachos.com", "TwitterHandle": "oliviafrocha", "InstagramHandle": "alquimiadostachos", "category": "Food", "image": "Alquimia Dos Tachos.jpg" }, { "Id": 16, "Name": "DINNER WAS DELICIOUS", "Description": "“Recipes, photographs, and a bunch of F-bombs” — One of my favorite descriptions of all time. Created by Chicago-based photographer Lucy Hewitt and writer/baker Rachel Adams, DinnerWasDelicious.com is a non-pretentious cook-a-thon well worth following.", "Blog": "DinnerWasDelicious.com", "TwitterHandle": "effingdelicious", "InstagramHandle": "EffingDelicious", "category": "Food", "image": "dinnerdelicious.png" }, { "Id": 17, "Name": "EAT THE LOVE", "Description": "San Francisco-based Irvin Lin, is known as the baker, writer, recipe maker. His blog, Eat the Love, features an extensive archive of tantalizing treats including a series of “wordless recipes.\" Here, everything looks as good as it tastes thanks to Lin’s keen eye, passion for food and attention to detail.", "Blog": "EatTheLove.com", "TwitterHandle": "EattheLove", "InstagramHandle": "eatthelove", "category": "Food", "image": "irvin_eyebrow_mini2.jpg" }, { "Id": 18, "Name": "CHEF IN DISGUISE", "Description": "Coming to you from the United Arab Emirates, Chef in Disguise is your go-to for authentic Middle Eastern dishes. From Feteer Meshaltet (Egyptian layered pastry) to Barazek (Honey pistachio sesame cookies), be inspired to expand your culinary horizons.", "Blog": "ChefInDisguise.com", "TwitterHandle": "ChefInDisguise", "InstagramHandle": "chefindisguise", "category": "Food", "image": "chefindisguise.jpg" }, { "Id": 19, "Name": "GOLUBKA KITCHEN", "Description": "It’s a mother and daughter duo behind the delicious dishes and striking imagery of Golubka Kitchen. Anya and older daughter Masha, have created a treasure trove of culinary delights to savor. Originally from Russia, Anya started the blog to share her love of tasty and nourishing cooking. Now with their cookbook The Vibrant Table (Roost Books), everyone can benefit from this Florida-based family affair.", "Blog": "GolubkaKitchen.com", "TwitterHandle": "GolubkaKitchen", "InstagramHandle": "golubka", "category": "Food", "image": "GOLUBKA KITCHEN.jpg" }, { "Id": 20, "Name": "ZEN AND SPICE", "Description": "Meditation and mindfulness are on the menu at Zen and Spice—a food blog based in Dallas, Texas. Created by Emily Hein, a Registered Dietitian Nutritionist, this site provides great nutrition tips, intriguing recipes and sage advice.", "Blog": "ZenandSpice.com", "TwitterHandle": "ZenandSpice", "InstagramHandle": "zenandspice", "category": "Food", "image": "ZEN AND SPICE.jpg" }, { "Id": 21, "Name": "Carolyn Edlund", "Description": "Carolyn Edlund spent 20 years running a full-time production studio, representing artists and selling their art and is now executive director for Art Business Institute (artbusinessinstitute.org). Her blog, Artsy Shark, provides many useful tips on better art business practices, artist vignettes and interviews with gallery owners.", "Blog": "http://www.artsyshark.com/", "TwitterHandle": "artsyshark", "InstagramHandle": "artsy_shark", "category": "Art", "image": "Carolyn Edlund.jpg" }, { "Id": 22, "Name": "Art Biz Coach", "Description": "Art Biz Coach is another useful site, offering direct consultation from the site’s curator, Alyson Stanfield. The site offers videos with advice on how to be successful showing your art. Find out what to expect from galleries, how to avoid alienating perspective buyers, resources that can help, and how to get emotional fulfillment from your art. Her site also provides links to workshops nationwide, books and other helpful websites.", "Blog": "http://artbizcoach.com/", "TwitterHandle": "abstanfield", "InstagramHandle": "abstanfield", "category": "Art", "image": "Art Biz Coach.jpg" }, { "Id": 23, "Name": "Daily Art Fixx", "Description": "Daily Art Fixx comments on art history and promotes unknown artists. It has links to facts, historical pieces and artists and quotes and links for art subgenres, including painting, photography, sculpture and video art. For artists hoping to use this blog as a self-promotion tool, site creator Wendy Campbell offers numerous options for submission: in a group gallery, where your piece will be displayed with works from others; in a short feature with one to four pieces; or in a full feature with six or more pieces and a short artist bio. A neat feature of Campbell’s site is the art-related prize- giveaway contest for any- one who chooses to enter.", "Blog": "http://www.dailyartfixx.com/", "TwitterHandle": "dailyartfixx", "InstagramHandle": "", "category": "Art", "image": "Daily Art Fixx.jpg" }, { "Id": 24, "Name": "We and the color", "Description": "WE AND THE COLOR is a blog for your daily art and design inspiration. We feature outstanding projects of various creative fields. In addition, you can find trendy graphics, templates, and fonts for download.", "Blog": "http://weandthecolor.com/", "TwitterHandle": "", "InstagramHandle": "weandthecolor", "category": "Art", "image": "We and the color.jpg" }, { "Id": 25, "Name": "Golem 13", "Description": "Art, geek & creativity", "Blog": "http://golem13.fr/", "TwitterHandle": "Golem_13", "InstagramHandle": "Golem_13", "category": "Art", "image": "golem.gif" }, { "Id": 26, "Name": "The Fox is Black", "Description": "The Fox Is Black is a culture blog showcasing matters of design and design that matters", "Blog": "http://thefoxisblack.com/", "TwitterHandle": "thefoxisblack", "InstagramHandle": "thefoxblack", "category": "Art", "image": "black-fox.jpg" }, { "Id": 27, "Name": "Where Cool Things Happen", "Description": "We keep you updated on where cool things happen | Cool Inspiration on Travel, Art, Lifestyle and more Cool stuff…", "Blog": "http://www.wherecoolthingshappen.com/", "TwitterHandle": "wherecoolthings", "InstagramHandle": "wherecoolthingshappen", "category": "Art", "image": "Where Cool Things Happen.jpg" }, { "Id": 28, "Name": "Designcollector", "Description": "Art, Design, Illustration, Photography, Music, Motion and Visual Overdose", "Blog": "http://designcollector.net/", "TwitterHandle": "Designcollector", "InstagramHandle": "designcollector", "category": "Art", "image": "Arseny Vesnin.jpg" }, { "Id": 29, "Name": "journaldesign", "Description": "journal design", "Blog": "http://www.journal-du-design.fr/", "TwitterHandle": "journaldesign", "InstagramHandle": "", "category": "Art", "image": "journal design.jpg" }, { "Id": 30, "Name": "The jealous curator", "Description": "A curator who is inspired (and just a tad jealous) of amazing contemporary art.", "Blog": "http://www.thejealouscurator.com/blog/", "TwitterHandle": "thejealouscurator", "InstagramHandle": "thejealouscurator", "category": "Art", "image": "The jealous curator.jpg" }, { "Id": 31, "Name": "It's Nice That", "Description": "Championing creativity across the art aS design world", "Blog": "http://www.itsnicethat.com/", "TwitterHandle": "itsnicethat", "InstagramHandle": "itsnicethat", "category": "Art", "image": "It's Nice That.jpg" }, { "Id": 32, "Name": "Booooooom", "Description": "Booooooom is an art + photo blog with a soft spot for hand-made work by unknown people.", "Blog": "http://www.booooooom.com/", "TwitterHandle": "booooooom", "InstagramHandle": "booooooom", "category": "Art", "image": "Booooooom.jpg" }];

influential
    .service('influencerService', [
        '$resource', function() {
            var service = this;
            service.filterByCategory = function(list, category) {
                return list.filter(function(itm) { return itm.Category === category; });
            };

            service.getInfluencerById = function(id) {
                var match = window.allInfluencers.filter(function(itm) { return itm.Id == id; });
                return match && match.length ? match[0] : null;
            }

        }
    ])
    .service('userDataService', [
        '$resource', function($resource) {
            var service = this;
            service.getTwitterusers = function() {
                return $resource("data/twitterusers.json");
            };
            service.getInstagramusers = function() {
                return $resource("data/instagramusers.json");
            };
            service.getUserById = function(users, id, idField) {
                var match = users.filter(function(itm) { return itm[idField] && itm[idField] == id; });
                return match && match.length ? match[0] : null;
            };

        }
    ])
     .service('subjectandTagService', [
        '$resource', function ($resource) {
            var service = this;
            
            service.getInstragramSubjects = function () {
                return $resource("data/instagramsubject.json");
            };

            service.getTweetSubjects = function () {
                return $resource("data/tweetsubject.json");
            };

            service.getRecentTweets = function () {
                return $resource("data/tweets.json");
            };

            service.getInstragramRecentPosts = function () {
                return $resource("data/instagram_posts.json");
            };

            service.getUserTopics = function () {
                return $resource("data/twittersubject-user.json");
            };
            service.getMostRecentPostsByUsers = function (data, uids, dateField, dataField) {
                var match = data.filter(function (itm) { return uids.indexOf(itm.UserName) >= 0 && itm[dataField]; });
                sortArrayByDateTimeDescending(match, dateField);
                return match && match.length ? match.splice(0, 10) : null;
            };
            service.getHashtagByUsers = function(data, uids, delimiter) {
                var match = data.filter(function (itm) { return uids.indexOf(itm.UserName) >= 0; });
                var hash = match.map(function(t) {
                    return t.Hashtags;
                });
                return getCleanTags(hash, delimiter);
            }

            //only available on industry level 
            service.getKeywordsCount= function(data) {
                return keywordsCount(data);
            }

            service.getBubblePos=function(data) {
               return getBubbleChartData(data);
            }
        }
     ])
    
    .service('mapService', function() {
        var style = {
            "styledMapName": "tbs",
            "styles": [
                {
                    "featureType": "road",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                }, {
                    "featureType": "landscape",
                    "stylers": [
                        { "color": "#ffffff" }
                    ]
                }, {
                    "featureType": "poi",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                }, {
                    "featureType": "road",
                    "stylers": [
                        { "color": "#dddddd" }
                    ]
                }, {
                    "featureType": "water",
                    "stylers": [
                        { "color": "#e0effe" }
                    ]
                }
            ],

            "mapTypeId": "tbs"
        };
        this.setUpMap = function(div, mapTags) {
            var map = new GMaps({
                div: div,
                lat: 0,
                lng: 0
            });
            map.addStyle(style);
            map.setStyle("tbs");

            for (var tagId in mapTags) {
                if (mapTags.hasOwnProperty(tagId)) {
                    (function() {
                        var tag = mapTags[tagId],
                            marker = map.addMarker({
                                "lat": tag.coordinates.lat,
                                "lng": tag.coordinates.lng
                            });

                        if (map.markers.length === 1) {
                            map.setZoom(15);
                            map.setCenter(tag.coordinates.lat, tag.coordinates.lng);
                        } else {
                            map.fitZoom();
                        }

                        var icon = new Image();
                        icon.onload = function() {
                            marker.setIcon(this.src);
                        };
                        icon.src = 'images/flags/' + tag.tag.toLowerCase() + '.png';
                        //console.log(icon.src);
                    })();
                }
            }
        }
    });


function getCleanTags(hash, delimiter) {
    var hashTags = [];
    var i, l = hash.length;
    for (i = 0; i < l; i++) {
        var tag = hash[i];
        if (tag && tag.length > 0) {

            hashTags = hashTags.concat(tag.split(delimiter));
        }
    }

    l = hashTags.length;
    var cleanTags = [];
    for (i = 0; i < l; i++) {
        if (hashTags[i].length > 0) {
            cleanTags.push(hashTags[i]);
        }
    }
    var counts = arrayElementCount(cleanTags);

    sortArrayByNumberDescending(counts);
   // console.log(counts);
    return counts.splice(0,9);
}

function sortArrayByNumberDescending(array, sortField) {
    var field = sortField || 'count';

    array.sort(function (a, b) {
        var keyA = a[field],
        keyB = b[field];
        if (keyA > keyB) return -1;
        if (keyA < keyB) return 1;
        return 0;
    });

}

function sortArrayByDateTimeDescending(array, dateField) {
    array.sort(function (a, b) {
        var keyA = new Date(a[dateField]),
        keyB = new Date(b[dateField]);
        // Compare the 2 dates
        if (keyA > keyB) return -1;
        if (keyA < keyB) return 1;
        return 0;
    });
}

function arrayElementCount(array) {
    var counts = {};

    for (var i = 0; i < array.length; i++){
        counts[array[i]] = (counts[array[i]] + 1) || 1;
    }

    var countArr = $.map(counts, function (value, index) {
        return [{name:index, count:value}];
    });

    return countArr;
}

function keywordsCount(array) {
    var counts = {};

    for (var i = 0; i < array.length; i++) {
        counts[array[i].keyword] = (counts[array[i].keyword] + array[i].count) || array[i].count;
    }

    var countArr = $.map(counts, function (value, index) {
        return [{ key: index, count: value }];
    });

    // console.log(countArr);
    return countArr;
}

function getBubbleChartData(data) {
    sortArrayByNumberDescending(data);
    var sorted = data,
        i, l = sorted.length,
        chartData=[], x, y, z;

    for (i = 0; i < l; i++) {
        x = Math.floor((Math.random() * 1000) + 1);
        y = Math.floor((Math.random() * 10) + 1);
        z = (data[i].Score * 100);
        chartData.push({
            x: x,
            y: y,
            z: z,
            name: data[i].key,
            count:data[i].count
        });
    }
    return chartData;
    //console.log(chartData);
}